# <img width="100" height="30" alt="그림 로고" src="https://github.com/user-attachments/assets/8d48f975-05ec-4cb1-ae53-fe0b8e18bf07" /> 과제1 (유튜브 과제)

데모 영상은 [여기](https://youtu.be/BpLMW05Iywg?si=F9arZuCDkNXpBwYe)에서 확인할 수 있습니다.

---
### 🕰️ 기간
- 2025.10.31(금) ~ 2025.11.03(월)
---

### 🌟 주제
- 버퍼로 픽셀 단위 원 그리기(윤곽/채우기) + 워커스레드 계산, 메인(UI)스레드 렌더링
---

### 🌟 세부 주제
- **버퍼 기반 픽셀 렌더링:** 오프스크린 버퍼(CImage 8bpp DIB)로 그린 뒤 한 번에 출력, 클릭 지점 원은 채움, 외접원은 테두리만
- **기하 알고리즘:** 세 점 외접원 계산 + 두께 적용 링 밴드 픽셀 렌더링
- **실시간 상호작용:** 클릭·드래그 즉시 재그림(정원이 따라 움직임)
- **비동기 시뮬레이션:** 워커 스레드로 (2Hz × 10)번 랜덤 이동, UI 프리징 방지
- **예외 · 안정성:** 경계 체크, 드래그 상태 관리, 중복 스레드 생성 차단 
- **사용성 / UI:** 반지름 · 두께 입력, 초기화/랜덤 버튼, 중심 좌표 표시

---
### ⚙️ 개발 환경
- **Language:** C++
- **Framework:** MFC
- **IDE:** Visual Studio 2022, GitHub Desktop

---
### 📌 구현 기능
**버퍼 기반 렌더링:**
- CImage 8bpp DIB(top‑down) 생성, 그레이 팔레트 설정, 전체 흰색 초기화

**픽셀 그리기:**
- 클릭 지점 원(채움) drawCircle로 픽셀 채우기
- 외접원 테두리(비채움) drawRingBand8bpp로 두께 밴드 렌더링

**입력/검증:**
- 반지름 · 두께 (IDC_EDIT_RADIUS, IDC_EDIT_THICKNESS) 입력 값 검증 (미입력 / 0 입력 시 메시지 안내)

**클릭 동작:**
- 최대 3개의 포인트 점까지 클릭 원 생성 및 보관 (포인트 점은 4번째부터 무시)

**외접원:**
- 포인트 점 3개 생성 시 computeCircumcircle로 중심 · 반지름 계산 후 테두리 그리기

**좌표 표시:** 
- 생성된 특정 포인트 점을 클릭하면 해당 점 중심 좌표를 (IDC_EDIT_CENTER)에 표시

**드래그 갱신:**
- 특정 포인트 점을 드래그하면 renderAll()로 실시간 재그림 (정원이 같이 이동)

**랜덤 이동(비동기):**
- [랜덤 이동] 버튼 클릭 시 워커 스레드 시작 (2Hz × 10회), 틱마다 3점 좌표 랜덤 갱신 → 메인 스레드에서 재그림

**스레드 안전:** 
- 워커(요구사항) → PostMessage(알림 전송) → 메인(UI)에서 좌표 계산 · 그리기 수행

**초기화:** 
- [초기화] 버튼 클릭 시 상태 · UI · 이미지 모두 리셋 (버퍼를 새로 만들지 않고, 현재 버퍼의 모든 픽셀을 다시 흰색으로 채움)

**화면 반영:**
- UpdateDisplay()에서 버퍼를 한 번에 Draw로 복사(무플리커 구조)

---
### 📝 문제점 및 해결 & 배운점
#### 문제점 및 해결:
- 플리커(깜빡임) 위험 → 오프스크린 버퍼(CImage 8bpp DIB)에서 완성 후 Draw 1회 복사로 해결
- Y축 뒤집힘 / 좌표 혼동 → Create(w, -h, 8)로 top‑down DIB 생성해 좌상단 (0,0) 통일
- GDI 스레드 안전성 → 워커는 PostMessage만, 메인(UI)에서 좌표 갱신·렌더링 전담
- 경계 밖 접근 위험 → 클릭 원 그릴 때 좌상단/하단 경계값 클램핑으로 메모리 오버런 방지
- 외접원 특이 케이스(3점이 일직선) → computeCircumcircle에서 판별식 체크 후 안전 탈출
- 입력 오류(반지름/두께 0 또는 미입력) → GetDlgItemInt 검증 + 메시지 안내
- UI 프리징(랜덤 이동 반복) → 워커 스레드(2Hz×10)에서 틱 전송, 메인에서만 렌더
- 중복 실행/재진입 위험 → [랜덤 이동] 버튼 비활성화로 재실행 차단


#### 배운 점:
- 화면에 직접 여러 번 지우고 그리면 지우는 순간과 중간 상태가 보여 깜빡임이 생기는 문제가 발생합니다.
  그래서 화면 밖 메모리(오프스크린 버퍼의 CImage 8bpp DIB 방식)에서 먼저 이미지를 완성 시킨 후,
  마지막에 한 번만 화면으로 복사하게 되면 그리는 과정이 노출되지 않아 깜빡임이 사라지고 드래그 중에도 매끄럽게 보인다는 점

- 스레드를 분리하지 않으면 UI가 멈출 수 있고, 멀티스레드에서 같은 자원을 동시에 다루면 충돌나는 문제가 발생합니다.
  그래서 스레드의 역할을 워커 스레드(알림)와 메인 스레드 (좌표 계산 · 렌더링)로 분리(멀티스레드) 시키게 되면 안전하고 단순한 구조를 만들 수 있다는 점
  
- top-down방식을 사용하지 않으면 줄 끝에서 다음 줄로 넘어갈 때 위치가 어긋나 “옆 줄”이나 “메모리 밖”에 그려버립니다.
  그래서 Create(w, -h, 8)로 top‑down(DIB) 좌표계를 화면과 일치시켜 Y축 혼동을 제거하고, GetPitch()를 사용해 fm[y * pitch + x]로 접근하여 줄 경계 넘어가기(오버런)를 방지할 수 있다는 점
  
- 외접원 중심 · 반지름을 부정확하게 계산하게 될 경우 테두리가 아예 안 그려지거나, 두께가 울퉁불퉁하게 보일 수 있는 오류가 납니다.
  그래서 외접원 공식을 이용해서 외접원 판별식(D)으로 일직선 특이 케이스를 먼저 걸러내고
  두께 범위(안 · 밖 반지름 제곱 범위) 조건으로 픽셀 채움 여부 결정하여 외접원의 테두리를 그릴 수 있다는 점
  
- Ellipse 등과 같은 도형 API 없이 픽셀 연산만으로 원 채움/테두리 두께를 충분히 구현 가능하다는 점

---
### ✅ 요구사항

- 아래 그림의 순서대로 조작하여 요구사항들을 모두 만족하는 프로그램을 작성합니다.  
- 세 번째 클릭 이후에 클릭 지점 3개를 모두 지나가는 정원 1개를 그립니다.  
- 클릭 지점 원을 그릴 때의 반지름 크기는 사용자로부터 입력 받습니다.  
- 각 클릭 지점 원의 중심 좌표를 UI에 표시합니다.  
- 네 번째 클릭부터는 클릭 지점 원을 그리지 않습니다.  
- 세 클릭 지점을 지나가는 정원의 내부는 채워지지 않아야 하며, 가장자리 두께는 사용자로부터 입력 받습니다.  
- 클릭 지점 3개 중 하나를 클릭하고 드래그 했을 때 정원을 다시 그립니다.  
- 이 때, 마우스 커서 좌표가 바뀌는 동안, 즉 마우스 드래그 상태가 끝날 때까지 정원이 계속해서 이동하며 그려져야 합니다.  
- [초기화] 버튼을 누르면 그려졌던 모든 내용들을 삭제하고 처음부터 입력 받을 수 있는 상태가 되어야 합니다.  
- 정원이 그려진 상태에서 [랜덤 이동] 버튼을 누르면 3개의 클릭 지점 원 모두를 랜덤한 위치로 이동시킵니다.  
- 이 때, 정원 또한 마찬가지로 다시 그려져야 합니다.  
- 랜덤한 위치로 이동 및 정원 그리기 동작을 초당 2회, 총 10번 자동으로 반복하되, 메인 UI가 프리징 상태가 되지 않도록 별도 쓰레드로 구현해야 합니다.  
- MFC Dialog 기반 프로젝트로 작성해야 합니다.  
- 클릭 지점 원과 정원을 그릴 때 아래 종류의 API를 사용하면 안 되며, 안내한 유튜브 영상에 나오는 방식으로 그려야 합니다.  
- `wingid`, `gdiplus`, `Ellipse`류, `FillPolygon`, `DrawPolygon` 등 사용 금지
- 정원이 그리기 영역을 벗어나는 경우는 아래와 같이 전체 원이 표시되지 않아도 됩니다.
<br>

<img width="1030" height="1112" alt="image" src="https://github.com/user-attachments/assets/70f203b0-0526-43a2-875b-070ec58b3c53" />
<img width="1084" height="394" alt="image (2)" src="https://github.com/user-attachments/assets/4d9607f3-20c8-49cf-a433-1acd1b590a30" />


---
### ▶️ 실행 방법

1) 과제1/GLIM.sln 열기
2) 솔루션 구성: Release 또는 Debug, 플랫폼: x64
3) 빌드: Ctrl+Shift+B
4) 실행: 상단 [로컬 Windows 디버거], F5 또는 과제1/x64/<구성>/GLIM.exe
<br>

**실행 시 주의사항:**
- 필수 구성: Windows, Visual Studio 2022, C++ MFC 데스크톱 개발 워크로드

---
### 📜 사용 방법(앱 조작 순서)

1) **캔버스 생성:** [배경 생성] 클릭 → 800×600 흰색 버퍼가 준비됩니다.
2) **반지름 입력:** 반지름 입력 칸에 반지름 숫자 입력
3) **점 찍기:** 캔버스에서 최대 3번 클릭 → 각 클릭 지점에 “채워진 점 원” 생성. 단, 반지름이 입력 되어있어야 합니다.
4) **두께 입력:** 두께 입력 칸에 테두리 두께 입력
5) **외접원 그리기:** 3번째 점이 생기면 세 점을 지나는 외접원 테두리가 그려집니다. 단, 두께가 입력 되어있어야 합니다.
6) **좌표 표시:** 점을 클릭하면 해당 점의 중심 좌표가 원의 중심 좌표 표시 칸에 표시됩니다.
7) **드래그 갱신:** 점을 마우스로 드래그하면 외접원 테두리가 실시간으로 따라 움직입니다.
8) **랜덤 이동:** [랜덤 이동] 클릭 → 2Hz로 10회, 세 점이 자동 이동하며 외접원이 매번 갱신됩니다. (프리징 없음)
9) **초기화:** [초기화] 클릭 → 상태 · UI · 이미지를 모두 리셋 (현재 버퍼를 흰색으로 클리어)

---
### 🎬 기능 GIF

- **배경 생성 버튼 클릭**

![1 배경 생성](https://github.com/user-attachments/assets/aac24cea-4da2-49d8-bbf2-abd04dcc5357)
<br><br><br>

- **반지름, 가장자리 두께 입력 후 3점 생성 및 외접원 생성**
  
![2 3점 생성 및 외접원 생성](https://github.com/user-attachments/assets/dc96e6dc-5571-403b-8596-098172a0093e)
<br><br><br>

- **원의 중심 좌표 표시**

![3 중심점 표시](https://github.com/user-attachments/assets/f53840cc-0602-4746-bf7e-973e15904d15)
<br><br><br>

- **드래그**

![4 드래그](https://github.com/user-attachments/assets/914e0514-e63d-48d8-b422-6f3c7191e2cb)
<br><br><br>

- **랜덤 생성 버튼 클릭**

![5 랜덤 생성](https://github.com/user-attachments/assets/410cb978-b061-4032-883d-8aeee8d25f10)
<br><br><br>

- **초기화 버튼 클릭**

![6 초기화](https://github.com/user-attachments/assets/606b1be1-2179-4d2e-ba28-5e91b7e5990f)
<br><br><br>

- **반지름 미입력 시 알림창**

![7 반지름 미입력](https://github.com/user-attachments/assets/a845a965-114c-418c-9dcc-7f55d6f689b8)
